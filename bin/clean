#!/bin/sh

export SYSTEM=$(uname)

if [ "$(id -u)" != "0" ]; then
	echo "Consider running this script as root to be sure of cleaning non current user / root old files."
fi

if [ "$1" = "deep" ]; then
    echo "Deep clean"
    rm -rf ~/.ivy2
    export DIST="dist"
fi

if [ "$1" = "sysonly" ]; then
  echo "Deep clean of user and system databases"
  cwd=`pwd`
  cd /Users
  for i in *; do
    rm -vf /Users/$i/$i.db*
    rm -vf /Users/$i/$i-svd*
    rm -vf /Users/$i/$i.pid
    rm -vf /Users/$i/.akka.conf
  done
  rm -vf /SystemUsers/0.pid
  rm -vf /SystemUsers/boot-svd*
  cd $cwd
  exit
fi

# bin/sbt clean
echo "Project source cleaned.."

case "${SYSTEM}" in

    Darwin|Linux)
        $(which bsdmake > /dev/null)
        if [ ! "$?" = "0" ]; then
            DEVEL= sofin get bsdmake
        fi
        if [ "${SYSTEM}" = "Darwin" ]; then
            export MAKE_OPTS="DARWIN=true ${MAKE_OPTS}"
        fi
        cd lib
        bsdmake ${DIST}clean ${MAKE_OPTS}
        cd ..
        ;;

    *)
        cd lib
        make ${DIST}clean
        cd ..
        ;;

esac
echo "Native code and libraries wiped out."
