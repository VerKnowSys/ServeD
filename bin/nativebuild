#!/bin/sh


system="$(uname)"
if [ -e "/usr/bin/clang++" ]; then
    export CXX="clang++"
else
    export CXX="g++"
fi

echo "System: $system"
echo "Compiler: $CXX"
echo

check() {
    if [ "$1" = "0" ]; then
        echo "* $2 => Compiled Sucessfully"
    else
        echo "* $2 => Failure"
        exit 1
    fi
}

$CXX -Os -fPIC lib/kickstart/shell.cc -o shell
check $? "UserShell"

if [ "$1" = "sh" ]; then
    exit
fi


$CXX -Os -c -fPIC lib/kickstart/core.cc -o lib/core.o
check $? "Core"

$CXX -Os -c -fPIC lib/kickstart/utils.cc -o lib/utils.o
check $? "Utils"

if [ "$system" = "Darwin" ]; then
    $CXX -Os -arch i386 -arch x86_64 -fPIC -shared lib/kickstart/stat.cc -o lib/libstat.dylib
else
    echo "Skipping build for $system"
    # $CXX -Os -fPIC -shared lib/kickstart/stat.cc -o lib/libstat.so
fi
check $? "StatLib"

$CXX -Os -fPIC lib/kickstart/kick.cc -o kick lib/core.o lib/utils.o
check $? "KickStart"

# rm -rf lib/*.o
