#!/bin/bash
# This Software is a close code project. You may not redistribute this code without permission of author.

. bin/OPTS


cd lib/pstree/
#make distclean

make clean
ulimit -c 0 # don't throw core file on segfault

if [ ! -e 'config.h' ]; then
    ./configure.sh --use-kvm # use kvm lib by default
fi

rm Makefile # removing auto generated Makefile with prepared one
cp Makefile.$platform Makefile
make

if [ "$?" -eq "0" ]; then
    cd test
    rm -rfv test
    gcc main.c -o test ../card.o ../ptree.o ../version.o ../pstree.o
    ./test
fi

exit 0