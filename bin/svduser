#!/bin/sh

unset DYLD_LIBRARY_PATH
unset LD_LIBRARY_PATH

userUID="$(id -u)"
pwd=$(pwd)
VERSION="$(cat VERSION)"
BUILD="$(cat svd.common/src/main/resources/BUILD)"
JAR="${pwd}/svd.user/target/user-assembly-${VERSION}-b${BUILD}.jar"

# read sofin configuration
. "/etc/profile_sofin"

# read user configuration
. "/Users/${userUID}/.profile"


JAVA_PATH="/Software/Openjdk/openjdk7/bin/java"


if [ "$1" != "" ]; then
  export userUID="$1"
fi

if [ "$(uname)" = "Darwin" ]; then
  export JAVA_PATH="/usr/bin/java"
fi

if [ -e "${JAR}" ]; then
  echo "Executing: ${JAR}"
  "${JAVA_PATH}" -d64 -XX:+UseCompressedOops -XX:MaxPermSize=64M -XX:+UseParallelGC -Xms8m -Xmx128m -Dfile.encoding=UTF-8 -noverify -client -Djna.library.path=$(pwd)/lib -jar "${JAR}" "${userUID}" "$@"
else
  echo "Assembly not found. Use build script!"
fi
