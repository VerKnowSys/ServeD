#!/bin/bash
# This Software is a close code project. You may not redistribute this code without permission of author.
# @author: dmilith


. bin/OPTS

echo "Running tests on platform: $platform, libs: $libs"

dirList=(
svd.gitbotnotifier
svd.maintainer
svd.systemmanager
svd.utils
)

for i in ${dirList[@]}; do
  cp -v lib/$libs src/$i/
done


cd src/
$MVN_EXEC $MVN_TEST_PARAMS test | sed -e 's/Tests run: \([^,]*\), Failures: \([^,]*\), Errors: \([^,]*\), Skipped: \([^,]*\)/[1;32mTests run: \1[0m, Failures: [1;31m\2[0m, Errors: [1;33m\3[0m, Skipped: [1;34m\4[0m/g' \
-e 's/\(\[WARNING\].*\)/[1;33m\1[0m/g' \
-e 's/\(\[INFO\].*\)/[1;37m\1[0m/g' \
-e 's/\(\[ERROR\].*\)/[1;31m\1[0m/g' \
-e 's/\(BUILD\ SUCCESS.*\)/[1;32m\1[0m/g' \
-e 's/\(BUILD\ FAILURE.*\)/[1;35m\1[0m/g' \
-e 's/\(FAILURE.*\)/[1;35m\1[0m/g' \
-e 's/\(SKIPPED.*\)/[1;33m\1[0m/g' \
-e 's/\(SUCCESS.*\)/[1;32m\1[0m/g' \
-e 's/\(Building.*\)/[1;36m\1[0m/g' \
-e 's/\(Unpacking.*\)/[1;32m\1[0m/g' \
-e 's/\(Installing.*\)/[1;32m\1[0m/g' \
-e 's/\(Compiling.*\)/[1;36m\1[0m/g'


for i in ${dirList[@]}; do
  rm -rf $i/$libs
done


exit 0
